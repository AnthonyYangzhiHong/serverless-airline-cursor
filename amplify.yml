version: 1
backend:
  phases:
    preBuild:
      commands:
        - npm install -g @aws-amplify/cli
        - echo "Completed installing Amplify CLI"
        - amplify --version
    build:
      commands:
        - echo "Starting Amplify backend push"
        - amplify pull --appId ${AMPLIFY_APP_ID} --envName ${AMPLIFY_ENV_NAME} --yes
        - amplify status
        - amplify push --yes
frontend:
  phases:
    preBuild:
      commands:
        - echo "Starting frontend preBuild"
        - cd src/items-frontend
        - npm install
        - echo "Copying aws-exports.js to frontend"
        - cp ../../aws-exports.js ./src/
    build:
      commands:
        - echo "Starting frontend build"
        - npm run build
        - echo "Completed frontend build"
  artifacts:
    baseDirectory: src/items-frontend/build
    files:
      - '**/*'
  cache:
    paths:
      - src/items-frontend/node_modules/**/* 