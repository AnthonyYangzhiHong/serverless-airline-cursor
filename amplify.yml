version: 1
backend:
  phases:
    preBuild:
      commands:
        - npm install -g @aws-amplify/cli
        - echo "Completed installing Amplify CLI"
    build:
      commands:
        - echo "Starting Amplify backend push"
        - amplify -v
        - amplify status
        - amplify push --simple
frontend:
  phases:
    preBuild:
      commands:
        - echo "Starting frontend preBuild"
        - cd src/items-frontend
        - npm install
        - echo "Pulling Amplify environment"
        - amplify pull --appId ${AMPLIFY_APP_ID} --envName ${AMPLIFY_ENV_NAME} --yes
    build:
      commands:
        - echo "Starting frontend build"
        - npm run build
        - echo "Completed frontend build"
  artifacts:
    baseDirectory: src/items-frontend/build
    files:
      - '**/*'
  cache:
    paths:
      - src/items-frontend/node_modules/**/* 